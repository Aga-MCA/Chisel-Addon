var G=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var E=(s,o,n,k)=>{if(o&&typeof o=="object"||typeof o=="function")for(let f of J(o))!K.call(s,f)&&f!==n&&G(s,f,{get:()=>o[f],enumerable:!(k=H(o,f))||k.enumerable});return s},V=(s,o,n)=>(E(s,o,"default"),n&&E(n,o,"default"));var l={};V(l,Y);import*as Y from"@minecraft/server";var D={[l.Direction.Up]:"above",[l.Direction.East]:"east",[l.Direction.West]:"west",[l.Direction.Down]:"below",[l.Direction.South]:"south",[l.Direction.North]:"north"};function $(s,o){try{return s.setPermutation(o),!0}catch{return!1}}function O(s,o,n){try{return s.withState(o,n)}catch{return s}}var C=class{constructor(o){this.permutation=o}tryWithState(o,n){let k=O(this.permutation,o,n);return new C(k)}},_=class{constructor(o){this.permutation=o;this.changed=!1}changeState(o,n){if(this.permutation.getState(o)===n)return this;try{this.permutation=this.permutation.withState(o,n),this.changed=!0}catch{}return this}};function A(s,o,n){if(typeof s=="string")return n===o.typeId?s:null;if(s instanceof Array){for(let k of s){let f=A(k,o,n);if(f)return f}return null}if(s.block_id&&s.block_id===o.typeId||s.block_tag&&o.hasTag(s.block_tag))return s.value}var Q=[l.Direction.Down,l.Direction.Up,l.Direction.North,l.Direction.South,l.Direction.West,l.Direction.East],S=class{onTick(o,{params:n}){if(!o.block.isValid)return;let k=new _(o.block.permutation);for(let f of Q)if(f in n){let z=o.block[D[f]](1),B=A(n[f],z,o.block.typeId)??"none",x=`block:${f.toLowerCase()}`,T=o.block.permutation.getState(x);B!==T&&k.changeState(x,B)}k.changed&&o.block.setPermutation(k.permutation)}};var t={ed:{x:1,y:-1,z:0},wd:{x:-1,y:-1,z:0},eu:{x:1,y:1,z:0},wu:{x:-1,y:1,z:0},en:{x:1,y:0,z:-1},wn:{x:-1,y:0,z:-1},es:{x:1,y:0,z:1},ws:{x:-1,y:0,z:1},ds:{x:0,y:-1,z:1},dn:{x:0,y:-1,z:-1},us:{x:0,y:1,z:1},un:{x:0,y:1,z:-1}},P=class{onTick(o,{params:n}){if(!o.block.isValid)return;let{"block:up":k,"block:down":f,"block:east":z,"block:west":B,"block:north":x,"block:south":T,"ctm:1":F,"ctm:2":N,"ctm:3":R,"ctm:4":W}=o.block.permutation.getAllStates(),c=[null,!0,!0,!0,!0];if(!n.simplify){let r=k==="this",m=f==="this",a=z==="this",i=B==="this",e=x==="this",y=T==="this";if(i!==a&&r&&m&&y&&e||!(i&&a)&&(r||m)&&(y||e)){let u=o.block.offset(t.ds),b=o.block.offset(t.dn),d=o.block.offset(t.us),p=o.block.offset(t.un);c[1]=u?.typeId===o.block.typeId,c[2]=b?.typeId===o.block.typeId,c[3]=d?.typeId===o.block.typeId,c[4]=p?.typeId===o.block.typeId}else if(i&&a&&r!==m&&y&&e||(i||a)&&!(r&&m)&&(y||e)){let u=o.block.offset(t.en),b=o.block.offset(t.es),d=o.block.offset(t.ws),p=o.block.offset(t.wn);c[1]=b?.typeId===o.block.typeId,c[2]=u?.typeId===o.block.typeId,c[3]=d?.typeId===o.block.typeId,c[4]=p?.typeId===o.block.typeId}else if(i&&a&&r&&m&&y!==e||(i||a)&&(r||m)&&!(y&&e)){let u=o.block.offset(t.ed),b=o.block.offset(t.eu),d=o.block.offset(t.wd),p=o.block.offset(t.wu);c[1]=u?.typeId===o.block.typeId,c[2]=b?.typeId===o.block.typeId,c[3]=d?.typeId===o.block.typeId,c[4]=p?.typeId===o.block.typeId}else if(i&&a&&(r||m)&&(e||y)){let u=o.block.offset(t.en),b=o.block.offset(t.wn),d=o.block.offset(t.es),p=o.block.offset(t.ws),w=o.block.offset(t.ed),I=o.block.offset(t.wd),h=o.block.offset(t.eu),g=o.block.offset(t.wu);c[1]=(e?u:d)?.typeId===o.block.typeId,c[2]=(e?b:p)?.typeId===o.block.typeId,c[3]=(r?h:w)?.typeId===o.block.typeId,c[4]=(r?g:I)?.typeId===o.block.typeId}else if((i||a)&&r&&m&&(e||y)){let u=o.block.offset(t.ds),b=o.block.offset(t.dn),d=o.block.offset(t.us),p=o.block.offset(t.un),w=o.block.offset(t.ed),I=o.block.offset(t.wd),h=o.block.offset(t.eu),g=o.block.offset(t.wu);c[1]=(e?b:u)?.typeId===o.block.typeId,c[2]=(e?p:d)?.typeId===o.block.typeId,c[3]=(i?I:w)?.typeId===o.block.typeId,c[4]=(i?g:h)?.typeId===o.block.typeId}else if((i||a)&&(r||m)&&y&&e){let u=o.block.offset(t.en),b=o.block.offset(t.wn),d=o.block.offset(t.es),p=o.block.offset(t.ws),w=o.block.offset(t.ds),I=o.block.offset(t.dn),h=o.block.offset(t.us),g=o.block.offset(t.un);c[1]=(r?h:w)?.typeId===o.block.typeId,c[2]=(r?g:I)?.typeId===o.block.typeId,c[3]=(i?p:d)?.typeId===o.block.typeId,c[4]=(i?b:u)?.typeId===o.block.typeId}else if((i||a)&&(r||m)&&(e||y)){let u=o.block.offset(t.ed),b=o.block.offset(t.wd),d=o.block.offset(t.eu),p=o.block.offset(t.wu),w=o.block.offset(t.en),I=o.block.offset(t.wn),h=o.block.offset(t.es),g=o.block.offset(t.ws),U=o.block.offset(t.ds),L=o.block.offset(t.dn),j=o.block.offset(t.us),q=o.block.offset(t.un);c[1]=(a?r?d:u:r?p:b)?.typeId===o.block.typeId,c[2]=(a?e?w:h:e?I:g)?.typeId===o.block.typeId,c[3]=(r?e?q:j:e?L:U)?.typeId===o.block.typeId,c[4]=W}}(F!==c[1]||N!==c[2]||R!==c[3]||W!==c[4])&&$(o.block,new C(o.block.permutation).tryWithState("ctm:1",c[1]).tryWithState("ctm:2",c[2]).tryWithState("ctm:3",c[3]).tryWithState("ctm:4",c[4]).permutation)}};l.system.beforeEvents.startup.subscribe(({blockComponentRegistry:s})=>{s.registerCustomComponent("aga:test_for_block",new S),s.registerCustomComponent("aga:ctm",new P)});
