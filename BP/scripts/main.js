var $=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var x=(e,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of A(t))!M.call(e,r)&&r!==o&&$(e,r,{get:()=>t[r],enumerable:!(i=F(t,r))||i.enumerable});return e},P=(e,t,o)=>(x(e,t,"default"),o&&x(o,t,"default"));var a={};P(a,H);import*as H from"@minecraft/server";var E={[a.Direction.Up]:"above",[a.Direction.East]:"east",[a.Direction.West]:"west",[a.Direction.Down]:"below",[a.Direction.South]:"south",[a.Direction.North]:"north"};function S(e,t){try{return e.setPermutation(t),!0}catch{return!1}}function w(e,t,o){try{return e.withState(t,o)}catch{return e}}var p=class{onTick(t,{params:o}){if(!t.block.isValid)return;let i=t.block.permutation.getAllStates(),r=t.block.getRedstonePower()??0;if(o.use_shared_active_power&&!t.block.getRedstonePower())for(let n of Object.values(E)){if("redstone:active"in i&&!("redstone:signal"in i)&&r)break;let s=t.block[n](1);if(!s)continue;let c=s.getRedstonePower();if(!c)continue;let l=c-1;l>r&&(r=l)}"redstone:signal"in i?S(t.block,w(t.block.permutation,"redstone:signal",r)):"redstone:active"in i&&S(t.block,w(t.block.permutation,"redstone:active",r>0))}};import{ModalFormData as U}from"@minecraft/server-ui";var d=class{constructor(t,o){this.id=t;this.states=o}},m=class{constructor(t,o){this.blocks=t;this.name=o}static BlockListItemToData(t){return t instanceof d?[t.id,t.states]:[t,void 0]}includes(t){return this.blocks.some(o=>typeof t=="string"?t===o:t instanceof d?o instanceof d?o.id===t.id&&Object.entries(o.states).every(i=>t.states[i[0]]===i[1]):o===t.id:o instanceof d?o.id===t.typeId&&Object.entries(o.states).every(i=>t.permutation.getAllStates()[i[0]]===i[1]):o===t.typeId)}getNext(t){let o=this.blocks.findIndex(i=>i instanceof d?i.id===t.typeId&&Object.entries(i.states).every(r=>t.permutation.getAllStates()[r[0]]===r[1]):i===t.typeId);return o===-1?null:(o===this.blocks.length-1&&(o=-1),o++,m.BlockListItemToData(this.blocks[o]))}getItem(t){let o=this.blocks.findIndex(i=>typeof t=="string"?t===i:t instanceof d?i instanceof d?i.id===t.id&&Object.entries(i.states).every(r=>t.states[r[0]]===r[1]):i===t.id:i instanceof d?i.id===t.typeId&&Object.entries(i.states).every(r=>t.permutation.getAllStates()[r[0]]===r[1]):i===t.typeId);return o===-1?null:this.blocks[o]}*[Symbol.iterator](){for(let t of this.blocks){let o=typeof t=="string"?t:t.id;a.BlockTypes.get(o)&&(yield o)}}},g=class{constructor(t){this.lists=t}includes(t){return this.lists.some(o=>o.includes(t))}getNext(t){for(let o of this.lists){let i=o.getNext(t);if(i)return i}return null}getList(t){return this.lists.find(o=>o.includes(t))}getItemInList(t,o){let i=this.getList(t);return i?i.includes(o):!1}*[Symbol.iterator](){for(let t of this.lists)t.name&&(yield t)}};function h(e){let t=e.getComponent(a.ItemComponentTypes.Durability),o=e.getComponent(a.ItemComponentTypes.Enchantable)?.getEnchantment("unbreaking")?.level||0;if(t){if(t.damage>=t.maxDurability)return;t.damage+=+(1/(o+1)>=Math.random())}return e}var L=["black","blue","brown","cyan","gray","green","light_blue","light_gray","lime","magenta","orange","pink","purple","red","white","yellow"];function k(e,[t,o],i,r){return i.map(n=>{let s=[`${t[0]}${n}${t[1]}`];for(let c=0;c<r.length;c++)s.push((e[1]?e[1]:"")+n+(e[2]?e[2]:"")+r[c]+(e[3]?e[3]:""));return new m(s,o)})}var T=["acacia","bamboo","birch","cherry","crimson","dark_oak","jungle","mangrove","oak","spruce","warped","pale_oak"];var u=new g([new m(["minecraft:dirt","aga_chisel:dirt_big_bricks","aga_chisel:dirt_bricks","aga_chisel:dirt_chunky","aga_chisel:dirt_classicbricks","aga_chisel:dirt_cobble","aga_chisel:dirt_happy","aga_chisel:dirt_horizontal","aga_chisel:dirt_layers","aga_chisel:dirt_netherbricks","aga_chisel:dirt_plate","aga_chisel:dirt_reinforced_cobble","aga_chisel:dirt_reinforced","aga_chisel:dirt_vert","aga_chisel:dirt_vertical"],"tile.dirt.name"),new m(["minecraft:redstone_lamp",new d("aga_chisel:redstone_lamp_square",{"redstone:active":!1})]),new m(["minecraft:lit_redstone_lamp",new d("aga_chisel:redstone_lamp_square",{"redstone:active":!0})]),new m(["minecraft:stone","minecraft:smooth_stone","minecraft:stone_bricks","minecraft:cracked_stone_bricks","minecraft:mossy_stone_bricks","minecraft:chiseled_stone_bricks"],"tile.stone.name"),new m(["minecraft:gold_block","aga_chisel:gold_badgreggy","aga_chisel:gold_bolted","aga_chisel:gold_bricks","aga_chisel:gold_cart","aga_chisel:gold_caution","aga_chisel:gold_coin_heads","aga_chisel:gold_coin_tails","aga_chisel:gold_crate_dark","aga_chisel:gold_crate_light","aga_chisel:gold_eye","aga_chisel:gold_largeingot","aga_chisel:gold_machine","aga_chisel:gold_plates","aga_chisel:gold_rivet","aga_chisel:gold_scaffold","aga_chisel:gold_simple","aga_chisel:gold_smallingot","aga_chisel:gold_space","aga_chisel:gold_spaceblack","aga_chisel:gold_star","aga_chisel:gold_thermal"],"tile.gold_block.name"),new m(["minecraft:diamond_block","aga_chisel:diamond_bismuth","aga_chisel:diamond_cells","aga_chisel:diamond_crushed","aga_chisel:diamond_embossed","aga_chisel:diamond_four_ornate","aga_chisel:diamond_four","aga_chisel:diamond_gem","aga_chisel:diamond_ornate_layer","aga_chisel:diamond_simple","aga_chisel:diamond_space_black","aga_chisel:diamond_space","aga_chisel:diamond_zelda"],"tile.diamond_block.name"),...k`${[["minecraft:","_block"],void 0]}aga_chisel:${["iron","copper"]}_${["badgreggy","bolted","caution","crate","machine","scaffold","thermal"]}`,...k`${[["minecraft:","_planks"],void 0]}aga_wood_variants:${T}_panels${[""]}`,...k`${[["minecraft:","_wool"],void 0]}aga_chisel:${L}_wool_${["llama","legacy"]}`]);function R(e,t){if(!t)return!0;let o=e.permutation.getAllStates();return Object.entries(t).every(i=>o[i[0]]===i[1])}function C(e,t,o){if(!u.includes(e))return!1;let i,r=t.getDynamicProperty("aga_chisel:data");if(r){let c=JSON.parse(r).find(l=>l&&u.getItemInList(e,l));c&&(i=m.BlockListItemToData(u.getList(e).getItem(c)))}if(i||(i=u.getNext(e)),!i)return;let n=i[0],s=i[1];n==e.typeId&&R(e,s)||a.system.run(()=>{if(e.setPermutation(a.BlockPermutation.resolve(n,s)),e.dimension.playSound("block.stonecutter.use",e.location,{pitch:1.4,volume:.6}),o.getGameMode()===a.GameMode.Creative)return;let c=o.getComponent("equippable"),l=h(t);c?.setEquipment(a.EquipmentSlot.Mainhand,l),l||o.playSound("random.break",{volume:1,pitch:1})})}function V(e){let t=e.block.permutation.getState("minecraft:block_face"),o;(t==="east"||t==="west")&&(e.blockFace===a.Direction.North&&(o=1),e.blockFace===a.Direction.South&&(o=2),e.blockFace===a.Direction.Up&&(o=3),e.blockFace===a.Direction.Down&&(o=4)),(t==="up"||t==="down")&&(e.blockFace===a.Direction.North&&(o=1),e.blockFace===a.Direction.South&&(o=2),e.blockFace===a.Direction.East&&(o=3),e.blockFace===a.Direction.West&&(o=4)),(t==="north"||t==="south")&&(e.blockFace===a.Direction.Up&&(o=1),e.blockFace===a.Direction.Down&&(o=2),e.blockFace===a.Direction.East&&(o=3),e.blockFace===a.Direction.West&&(o=4)),a.system.run(()=>{if(o){let i=`face:${o}`,r=e.block.permutation.getState(i)+1;e.block.setPermutation(e.block.permutation.withState(i,r>6?1:r))}})}function B(e){let{block:t,player:o,itemStack:i}=e;t.typeId==="aga_chisel:gold_eye"&&V(e),a.system.run(()=>{if(o.getGameMode()===a.GameMode.Creative)return;let r=o.getComponent("equippable"),n=h(i);r?.setEquipment(a.EquipmentSlot.Mainhand,n),n||o.playSound("random.break",{volume:1,pitch:1})})}function q(e){let{block:t,player:o}=e,i=e.itemStack,r=o.getBlockFromViewDirection();if(!r)return{block:t,player:o,itemStack:i};let n=r.block.x===t.x,s=r.block.y===t.y,c=r.block.z===t.z;if(!(n&&s&&c))return{block:t,player:o,itemStack:i};let{faceLocation:_,face:N}=r;return{block:t,blockFace:N,faceLocation:_,player:o,itemStack:i}}function D(e){let{block:t,itemStack:o,player:i}=e;if(!o)return!1;let r=o?.getTags().includes("addon:offset"),n=o?.getTags().includes("addon:chisel");return i.timeout||(i.timeout=!0,a.system.runTimeout(()=>{i.timeout=!1},5),r&&e.faceLocation&&e.blockFace&&B(e),n&&C(t,o,i)),n||r}a.world.beforeEvents.playerBreakBlock.subscribe(e=>{e.cancel=D(q(e))});a.world.beforeEvents.playerInteractWithBlock.subscribe(e=>{e.player.isSneaking&&!e.isFirstEvent||(e.cancel=D(e))});var I="\xA75+Chisel Data\xA7r";function O(e){let t=new U().title({translate:"chisel.ui"}).toggle({translate:"chisel.ui.active-data"},{defaultValue:!0}),o="gui.none";for(let i of u)t.dropdown({translate:i.name},[o,...i].map(r=>({translate:r==o?r:`tile.${r.replace("minecraft:","")}.name`})));t.show(e.source).then(i=>{if(i.canceled||!i.formValues)return;let r=i.formValues[0],n=[...u];if(r){let s=[];for(let c=0;c<n.length;c++){let l=[...n[c]][i.formValues[c+1]-1];s.push(l),e.itemStack.setDynamicProperty("aga_chisel:data",JSON.stringify(s)),e.itemStack.setLore([...e.itemStack.getLore().filter(_=>_!=I),I])}}else e.itemStack.setDynamicProperty("aga_chisel:data"),e.itemStack.setLore(e.itemStack.getLore().filter(s=>s!=I));e.source.getComponent("equippable")?.setEquipment(a.EquipmentSlot.Mainhand,e.itemStack)})}var b=class{onUse(t,{params:o}){t.source.isSneaking&&o.with_ui&&O(t)}onUseOn(t,{params:o}){t.source.isSneaking&&o.with_ui&&t.source instanceof a.Player&&O(t)}};var f=class{constructor(){this.data=[]}add(t){this.data.includes(t)||this.data.push(t)}intersection(t){let o=new f;for(let i of this.data)t.includes(i)&&o.add(i);return o}includes(t){return this.data.includes(t)}get size(){return this.data.length}};function G(e){let t=new f,o=0;for(let i of e.getTags()){let r=0;i==="minecraft:iron_tier_destructible"&&(r=3),i==="minecraft:stone_tier_destructible"&&(r=2),i==="minecraft:diamond_tier_destructible"&&(r=4),i==="minecraft:netherite_tier_destructible"&&(r=5),i==="minecraft:is_sword_item_destructible"&&t.add(4),i==="minecraft:is_mace_item_destructible"&&t.add(7),i==="minecraft:is_hoe_item_destructible"&&t.add(5),i==="minecraft:is_axe_item_destructible"&&t.add(2),i==="minecraft:is_pickaxe_item_destructible"&&(t.add(1),r=1),i==="minecraft:is_shovel_item_destructible"&&t.add(3),i==="minecraft:is_shears_item_destructible"&&t.add(6),r>o&&(o=r)}return{tools:t,tier:o}}function z(e){let t=new f,o=0,i=!1;if(e){for(let n of e.getTags()){let s=0;n==="minecraft:golden_tier"&&(s=1),n==="minecraft:wooden_tier"&&(s=1),n==="minecraft:stone_tier"&&(s=2),n==="minecraft:copper_tier"&&(s=2),n==="minecraft:iron_tier"&&(s=3),n==="minecraft:diamond_tier"&&(s=4),n==="minecraft:netherite_tier"&&(s=5),n==="minecraft:is_pickaxe"&&t.add(1),n==="minecraft:is_shovel"&&t.add(3),n==="minecraft:is_shears"&&t.add(6),n==="minecraft:is_sword"&&t.add(4),n==="minecraft:is_mace"&&t.add(7),n==="minecraft:is_hoe"&&t.add(5),n==="minecraft:is_axe"&&t.add(2),s>o&&(o=s)}let r=e.getComponent("enchantable");r?.isValid&&(i=r.hasEnchantment("silk_touch"))}return{tools:t,tier:o,use_silk_touch:i}}a.world.beforeEvents.playerBreakBlock.subscribe(e=>{if(e.player.getGameMode()===a.GameMode.Creative)return;let t=e.block.getComponent("aga:only_tool_destructible");if(!t?.isValid)return;let{tools:o,tier:i}=G(e.block);if(o.size===0)return;let{tools:r,tier:n,use_silk_touch:s}=z(e.itemStack),c=o.intersection(r).size>=1&&i<=n,{params:l}=t.customComponentParameters;if(s&&(c||l?.silk_touch?.ignore_tool)){l.silk_touch.loot&&(a.system.run(()=>{e.dimension.runCommand(`loot spawn ${e.block.x} ${e.block.y} ${e.block.z} loot ${l.silk_touch.loot} ${e.itemStack??""}`),e.block.setType("minecraft:air")}),e.cancel=!0);return}if(!c){a.system.run(()=>e.block.setType("minecraft:air")),e.cancel=!0;return}l.loot&&a.system.run(()=>{e.dimension.runCommand(`loot spawn ${e.block.x} ${e.block.y} ${e.block.z} loot ${l.silk_touch.loot} ${e.itemStack??""}`)});let _=e.block.getItemStack(1);a.system.run(()=>e.dimension.spawnItem(_,e.block.location))});var y=class{};a.system.beforeEvents.startup.subscribe(({blockComponentRegistry:e,itemComponentRegistry:t})=>{e.registerCustomComponent("aga:redstone",new p),e.registerCustomComponent("aga:only_tool_destructible",new y),t.registerCustomComponent("aga_chisel:chisel",new b)});
